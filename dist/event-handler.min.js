/* event-handler 2014-08-14 */
!function(a,b){var c={};c.EntityEvent=function(){var a=function(a,b,c){this.event=a,this.handler=b,this.data="object"==typeof c?c:{}};return a.prototype.getEvent=function(){return this.event},a.prototype.getHandler=function(){return this.handler},a.prototype.getEntity=function(){return this.handler.getEntity()},a.prototype.getData=function(a){return this.data.hasOwnProperty(a)?this.data[a]:b},a}(c),c.EventHandler=function(a){var b=function(a,b){if(this.entity=a,this.events={all:[]},b)for(var c=0,d=b.length;d>c;c++)this.events[b[c]]=[];this.alias()};return b.prototype.getEntity=function(){return this.entity},b.prototype.alias=function(){var a=this;this.entity.on=function(b,c,d){a.on(b,c,d)},this.entity.once=function(b,c,d){a.once(b,c,d)},this.entity.off=function(b,c,d){a.off(b,c,d)},this.entity.trigger=function(b,c){a.trigger(b,c)}},b.prototype.on=function(a,b,c){return this.events.hasOwnProperty(a)||(this.events[a]=[]),this.events[a].push({action:b,context:c||this.entity}),this.entity},b.prototype.once=function(a,b,c){var d=this,e=function(){d.off(a,e),b.apply(this,arguments)};return e._action=b,this.on(a,e,c)},b.prototype.off=function(a,b,c){if(!b&&!c)return a?this.events[a]=[]:this.clear(),this.entity;var d,e,f,g=this.events[a],h=[];for(d=0,e=g.length;e>d;d++)f=g[d],(b&&b!==f.action&&b!==f.action._action||c&&c!==f.context)&&h.push(f);return this.events[a]=h,this.entity},b.prototype.trigger=function(b,c){var d=new a.EntityEvent(b,this,c);return this.events.hasOwnProperty(b)&&this.triggerEvents(this.events[b],d),this.events.hasOwnProperty("all")&&this.triggerEvents(this.events.all,d),this.entity},b.prototype.triggerEvents=function(a,b){for(var c=0,d=a.length;d>c;c++)a[c].action.call(a[c].context,b)},b.prototype.clear=function(){for(var a in this.events)this.events.hasOwnProperty(a)&&(this.events[a]=[])},b}(c),a.EventHandler=c.EventHandler}("undefined"!=typeof window?window:this);